# GitHub Repository Analysis Tool

This tool uses Claude Code's MCP capabilities to automatically analyze GitHub repositories, generate documentation, and create visual diagrams of code architecture.

## Features

- **Repository Analysis**: Clone and analyze GitHub repositories
- **Code Structure Mapping**: Generate maps of code organization and relationships
- **Critical File Identification**: Highlight the most important files in the repository
- **Diagram Generation**: Create component, sequence, and class diagrams
- **Documentation Creation**: Generate comprehensive markdown documentation

## Output Examples

You can find sample outputs generated by this tool in the `examples/` directory of this repository. These examples include generated documentation and diagrams to help you understand what to expect from running the tool.

## Recent Updates

- **Confluence Integration**: Now supports automatic upload of documentation and diagrams to Atlassian Confluence spaces using the Conduit MCP server.

## Setup

1. Clone this repository:
   ```bash
   git clone https://github.com/your-username/gh-repo-code-intelligence.git
   cd gh-repo-code-intelligence
   ```

2. Configure Claude permissions by copying the settings template:
   ```bash
   cp .claude/settings.local.json.template .claude/settings.local.json
   ```
   This file contains the necessary permissions for Claude to use all required tools.

3. Configure MCP tools by copying the provided template:
   ```bash
   cp .mcp.json.template ~/.claude/.mcp.json
   ```
   Edit the file to make any necessary adjustments as indicated in the template comments.
   
   **For Confluence integration**: You'll need to configure the Conduit MCP server with your Atlassian credentials. See the [Conduit MCP documentation](https://github.com/atlassian-labs/mcp-server-conduit) for setup details.

4. Create a `config.json` file based on the template:
   ```bash
   cp config.json.template config.json
   ```

5. Edit `config.json` to include the repositories you want to analyze:
   ```json
   {
     "repos": [
       {
         "name": "organization/repository-name",
         "github_url": "https://github.com/organization/repository-name"
       }
     ],
     "preferred_diagrams": ["component", "sequence", "class"],
     "doc_format": "markdown",
     "analysis_options": {
       "critical_files_limit": 50,
       "include_metrics": true,
       "max_tokens": 5000
     },
     "confluence": {
       "enabled": false,
       "site_alias": "your-site-alias",
       "space_key": "YOUR_SPACE",
       "parent_page_title": "Parent Page Title"
     }
   }
   ```

   ### Confluence Integration (Optional)
   
   To enable automatic upload of documentation to Confluence:
   
   1. Set `confluence.enabled` to `true`
   2. Configure your Atlassian site alias, space key, and parent page
   3. Ensure the Conduit MCP server is configured in `.mcp.json` with proper authentication
   
   When enabled, the tool will upload generated documentation and diagrams as Confluence pages.

   > **IMPORTANT**: Always use HTTPS URLs (`https://github.com/...`) for repositories, not SSH URLs (`git@github.com:...`). 
   > SSH URLs will prompt for SSH key passphrase, which breaks automation. However, if you do provide a URL that starts with git@github.com:..., Claude Code will attempt to convert that to https://github.com/... and use that for clone operations.

## Usage

Run the tool using Claude Code:

```bash
cd /path/to/gh-repo-code-intelligence
claude -p "Analyze repositories according to CLAUDE.md"
```

This will:

1. Read repositories from your `config.json`
2. Create or update `state.json` to track progress
3. Clone or refresh each repository 
4. Analyze the repository structure
5. Generate diagrams based on the code analysis
6. Create comprehensive documentation with embedded diagrams
7. Store all outputs in the `output/` directory with timestamped folders
8. (Optional) Upload documentation and diagrams to Confluence if enabled

## Output Structure

```
output/
└── {repo_name}/
    └── {timestamp}/
        ├── docs.md        <- Generated documentation
        └── diagrams/      <- Generated diagrams
            ├── component_diagram.png
            ├── sequence_diagram.png
            └── class_diagram.png
```

## Debugging

For troubleshooting or detailed analysis of the tool's operation, use verbose mode with JSON output:

```bash
claude -p "Analyze repositories according to CLAUDE.md" --verbose --output-format stream-json | tee output.json
```

This will:
- Show detailed progress and debugging information
- Output structured JSON data for each step
- Save all output to `output.json` for later analysis
- Allow real-time monitoring of the analysis process

## Requirements

- Claude Code CLI
- MCP tools access (code-understanding and mermaid_image_generator)

## MCP Tool Setup

This project depends on two MCP tools: **code-understanding** and **mermaid_image_generator**.  
To use this tool, you must install and configure these MCP tools so they are available to Claude Code.

- **Code Understanding MCP Tool**  
  [GitHub Repository](https://github.com/codingthefuturewithai/mcp-code-understanding.git)  
  [PyPI Package](https://pypi.org/project/code-understanding-mcp-server/)

- **Mermaid Image Generator MCP Tool**  
  [GitHub Repository](https://github.com/codingthefuturewithai/mcp_mermaid_image_gen.git)  
  [PyPI Package](https://pypi.org/project/mcp-mermaid-image-gen/)

For setup and configuration instructions, see the documentation in each repository above.  
You will need to add the appropriate entries to your `Claud.mcp.json` file so Claude Code can use these tools.

### MCP Configuration

This repository includes a `.mcp.json.template` file that contains the configuration for the required MCP tools. Copy this file to `~/.claude/.mcp.json` and edit it as needed to ensure Claude Code can access the MCP tools properly.

### GitHub Authentication

For the code-understanding MCP tool to clone repositories:

1. **Public repositories**: No authentication required, but rate limits apply
   
2. **Private repositories**: Requires a GitHub Personal Access Token:
   ```json
   "code-understanding": {
     "command": "code-understanding-mcp-server",
     "args": [
       "--cache-dir", "/path/to/cache-dir",
       "--max-cached-repos", "20"
     ],
     "env": {
       "GITHUB_TOKEN": "your-personal-access-token"
     }
   }
   ```

3. **URL format**: Regardless of repository visibility:
   - **Always use HTTPS URLs** in your config.json, not SSH URLs
   - SSH URLs will prompt for SSH key passphrase, breaking automation
   - Example: use `https://github.com/organization/repo-name.git` instead of `git@github.com:organization/repo-name.git`

## Configuration Options

See `config.json.template` for the full configuration options. Key settings include:

- `repos`: List of repositories to analyze
- `preferred_diagrams`: Types of diagrams to generate
- `analysis_options`: Settings for code analysis depth and detail

## Future Enhancements

We're actively working on enhancing this tool with more features:

- **Confluence Integration**: Automatically publish documentation to Atlassian Confluence spaces
- **Documentation Templates**: Customizable templates for different types of documentation
- **Enhanced Diagram Types**: Additional diagram formats for more comprehensive visualization
- **Automated Scheduling**: Integrated scheduling for regular repository analysis updates

## License

MIT